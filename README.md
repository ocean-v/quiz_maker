# quiz_maker
Quiz maker by R &amp; COTOHA

# 例
### 日本史
例えば[Wikipediaの記事「鎌倉時代」](https://ja.wikipedia.org/wiki/%E9%8E%8C%E5%80%89%E6%99%82%E4%BB%A3)の「概要」を使うと次のような感じ（全文は載せられないので一部分）。

問題
> 12世紀末に、（　1　）が（　2　）として（　3　）の頂点に立ち、全国に守護を置いて、（　4　）を開いた。京都の（　5　）と地方の荘園・（　6　）はそのままで、地方支配に地頭等の形で（　3　）が割り込む二元的な支配構造ができあがった。（　7　）は「（　2　）」頼朝の私的家政機関として設立されており、公的機関ではない。したがって基本的に（　4　）が支配下に置いたのは（　2　）の知行国および主従関係を結んだ（　3　）（（　8　））であり、守護の設置などで諸国の治安維持等を担当したものの、全国の（　3　）を完全な支配下に治めたわけではない。（　9　）が（　5　）に入り込み、（　5　）を通じて支配を試みたのとは対照的である。
・・・・
*[Wikipedia　鎌倉時代]((https://ja.wikipedia.org/wiki/%E9%8E%8C%E5%80%89%E6%99%82%E4%BB%A3))を一部改変*

解答

```answer.csv
番号,答え
1,源頼朝
2,鎌倉殿
3,武士
4,鎌倉幕府
5,朝廷
6,公領
7,幕府
8,御家人
9,平氏政権
・・・・
```

# 使い方
## ***注意***
**今回のコードでできるのはあくまでも「穴埋め問題みたいなもの」を作成することだけです。その単元で中で重要だから空欄になっているわけではありませんし、テストや受験で出る単語をカバーしているわけでもない点にご注意ください。メインの勉強はちゃんとした練習問題などで行ってもらって、空いた時間にでも使ってみていただければと思います。
また使用するテキストの著作権にも十分配慮していただき、作成した問題も個人利用にとどめていただければと思います。**
内容によって生じた損害等の一切の責任を負いかねますのでごめんなさい。


## 環境
Ubuntu18.04、Windows10で動作確認しました。
ただ、Windows10では長い文が処理できないようなので注意（接続が不安定？要確認）。

## 準備
### Rの準備

- Rのインストール
Rを入れていない場合はRをインストールします。
方法はその他のサイトに任せますが、パッケージの依存関係を満たせない場合があるのでできるだけ最新版を入れてください。

- Rのパッケージのインストール
Rで以下のコマンドから必要パッケージをインストールします。
tidyverseなどがすでにインストールされている場合は依存関係が壊れないように注意してください。

```R
install.packages("tidyverse")
install.packages("magrittr")
install.packages("httr")
install.packages("jsonlite")
```

### コードのダウンロード
このページからファイルをダウンロード（あるいはレポジトリをクローン）して、任意のフォルダにファイルを保存します。
保存できたら`quiz_maker.r`があるフォルダを開いておきます。
ファイルのエンコードはUTF-8になっているので注意してください。


### COTOHAの準備
- COTOHA for Developpersへの登録
登録していない場合は[COTOHAのページ](https://api.ce-cotoha.com/contents/index.html)から無料のfor Developpersに登録します。

- アカウントホームの確認
各種情報を確認しておきます。

- `config.json`の編集
フォルダ内の`config.json`をメモ帳等のエディタで開いて、[client id]と[client secret]を先程確認した自分のものに書き換えます。

- `endpoint.r`の編集
フォルダ内の`endpoint.r`をメモ帳等のエディタで開いて、[Access Token Publish URL]、[API Base URL]を確認したものに書き換えます。


### テキストの準備
問題に使いたい文章を`text.txt`に書き込みます。エンコードをUTF-8にしないとうまく行かないと思うので注意してください。
基準がよくわからないのですがUbuntuだと2500文字、Windowsだと500文字くらいを超えるとうまく行かないみたいなので、それ以下の文字数のテキストを使いましょう。


## 実行
上記の準備ができたらRを起動し、`quiz_maker.r`があるフォルダを作業ディレクトリに指定します。

その後`source("quiz_maker.r", encoding = "utf-8")`をRから実行すると処理が開始されます。
エラーが起きた場合はテキストを短くするか、時間をおいてやり直すとうまく行くかもしれません（ステータスコードで500が連続で出るなら短くしたほうがいいかも）。

※1 リクエストのポストは最低20秒間隔になるようにしています。また過剰な繰り返しを防ぐため、処理開始から3分経過した時点で処理を中断するようにしています。
※2 for Developpersの上限は「各API、1,000コール/日」なので注意してください。

## 出力
上記コードを実行すると処理中にはリクエストの結果が表示されます。
うまく行った場合には問題文が`quiz_[日時].txt`の中に、解答が`answer_[日時].csv`の中に保存されます。

コードはもっとスマートに書けるかもしれないので自分で書き換えてみてください。
